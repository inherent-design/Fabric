#!/bin/sh
# Pre-commit hook: run clang-format on staged C++ files.
# Install: git config core.hooksPath .githooks
set -eu

# Collect staged .cc and .hh files
staged=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(cc|hh)$' || true)

if [ -z "$staged" ]; then
  exit 0
fi

if ! command -v clang-format >/dev/null 2>&1; then
  echo "error: clang-format not found. Install via: brew install llvm" >&2
  exit 1
fi

# Format staged files in-place and re-stage them
echo "$staged" | xargs clang-format -i
echo "$staged" | xargs git add

echo "clang-format: $(echo "$staged" | wc -l | tr -d ' ') file(s) formatted and re-staged"
